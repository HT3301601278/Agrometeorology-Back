# 数据库设计

## 用户相关表

### user 用户表

| 字段名     | 数据类型     | 描述                | 约束           |
| ---------- | ------------ | ------------------- | -------------- |
| id         | BIGINT       | 用户ID              | 主键，自增     |
| username   | VARCHAR(50)  | 用户名              | 非空，唯一     |
| password   | VARCHAR(255) | 密码(不要加密)      | 非空           |
| nickname   | VARCHAR(50)  | 昵称                |                |
| email      | VARCHAR(100) | 邮箱                | 唯一           |
| avatar     | VARCHAR(255) | 头像URL             |                |
| phone      | VARCHAR(20)  | 联系电话            |                |
| role       | VARCHAR(20)  | 角色(USER/ADMIN)    | 非空，默认USER |
| status     | TINYINT      | 状态(0:冻结,1:正常) | 非空，默认1    |
| created_at | DATETIME     | 创建时间            | 非空           |
| updated_at | DATETIME     | 更新时间            | 非空           |

### notification_setting 通知设置表

| 字段名        | 数据类型 | 描述             | 约束           |
| ------------- | -------- | ---------------- | -------------- |
| id            | BIGINT   | 设置ID           | 主键，自增     |
| user_id       | BIGINT   | 用户ID           | 外键，非空     |
| email_notify  | BOOLEAN  | 是否开启邮件通知 | 非空，默认true |
| system_notify | BOOLEAN  | 是否开启站内通知 | 非空，默认true |
| updated_at    | DATETIME | 更新时间         | 非空           |

### notification 通知记录表

| 字段名     | 数据类型     | 描述                    | 约束            |
| ---------- | ------------ | ----------------------- | --------------- |
| id         | BIGINT       | 通知ID                  | 主键，自增      |
| user_id    | BIGINT       | 接收用户ID              | 外键，非空      |
| title      | VARCHAR(100) | 通知标题                | 非空            |
| content    | TEXT         | 通知内容                | 非空            |
| type       | TINYINT      | 通知类型(1:系统,2:预警) | 非空            |
| is_read    | BOOLEAN      | 是否已读                | 非空，默认false |
| created_at | DATETIME     | 创建时间                | 非空            |

## 地块相关表

### field_group 地块组表

| 字段名      | 数据类型     | 描述       | 约束       |
| ----------- | ------------ | ---------- | ---------- |
| id          | BIGINT       | 地块组ID   | 主键，自增 |
| user_id     | BIGINT       | 所属用户ID | 外键，非空 |
| name        | VARCHAR(50)  | 地块组名称 | 非空       |
| description | VARCHAR(255) | 描述       |            |
| created_at  | DATETIME     | 创建时间   | 非空       |
| updated_at  | DATETIME     | 更新时间   | 非空       |

### field 地块表

| 字段名          | 数据类型      | 描述         | 约束       |
| --------------- | ------------- | ------------ | ---------- |
| id              | BIGINT        | 地块ID       | 主键，自增 |
| user_id         | BIGINT        | 所属用户ID   | 外键，非空 |
| group_id        | BIGINT        | 所属地块组ID | 外键       |
| name            | VARCHAR(50)   | 地块名称     | 非空       |
| area            | DECIMAL(10,2) | 面积(平方米) |            |
| soil_type       | VARCHAR(20)   | 土壤类型     |            |
| crop_type       | VARCHAR(50)   | 作物类型     |            |
| planting_season | VARCHAR(20)   | 种植季节     |            |
| growth_stage    | VARCHAR(20)   | 生长阶段     |            |
| latitude        | DECIMAL(10,6) | 纬度         | 非空       |
| longitude       | DECIMAL(10,6) | 经度         | 非空       |
| created_at      | DATETIME      | 创建时间     | 非空       |
| updated_at      | DATETIME      | 更新时间     | 非空       |

## 气象数据相关表

### weather_current 实时天气表

| 字段名              | 数据类型      | 描述            | 约束       |
| ------------------- | ------------- | --------------- | ---------- |
| id                  | BIGINT        | 记录ID          | 主键，自增 |
| latitude            | DECIMAL(10,6) | 纬度            | 非空       |
| longitude           | DECIMAL(10,6) | 经度            | 非空       |
| dt                  | BIGINT        | 数据时间戳      | 非空       |
| temp                | DECIMAL(5,2)  | 温度            | 非空       |
| feels_like          | DECIMAL(5,2)  | 体感温度        |            |
| temp_min            | DECIMAL(5,2)  | 最低温度        |            |
| temp_max            | DECIMAL(5,2)  | 最高温度        |            |
| pressure            | INT           | 气压(hPa)       |            |
| humidity            | INT           | 湿度(%)         |            |
| wind_speed          | DECIMAL(5,2)  | 风速            |            |
| wind_deg            | INT           | 风向(度)        |            |
| wind_gust           | DECIMAL(5,2)  | 阵风            |            |
| clouds_all          | INT           | 云量(%)         |            |
| visibility          | INT           | 能见度(米)      |            |
| rain_1h             | DECIMAL(5,2)  | 1小时降雨量(mm) |            |
| snow_1h             | DECIMAL(5,2)  | 1小时降雪量(mm) |            |
| weather_id          | INT           | 天气状况ID      |            |
| weather_main        | VARCHAR(50)   | 天气主要状况    |            |
| weather_description | VARCHAR(100)  | 天气描述        |            |
| weather_icon        | VARCHAR(20)   | 天气图标        |            |
| created_at          | DATETIME      | 记录创建时间    | 非空       |

### weather_forecast 天气预报表

| 字段名              | 数据类型      | 描述                             | 约束       |
| ------------------- | ------------- | -------------------------------- | ---------- |
| id                  | BIGINT        | 记录ID                           | 主键，自增 |
| latitude            | DECIMAL(10,6) | 纬度                             | 非空       |
| longitude           | DECIMAL(10,6) | 经度                             | 非空       |
| dt                  | BIGINT        | 预报时间戳                       | 非空       |
| forecast_type       | TINYINT       | 预报类型(1:小时级,2:16天,3:30天) | 非空       |
| temp                | DECIMAL(5,2)  | 温度                             | 非空       |
| feels_like          | DECIMAL(5,2)  | 体感温度                         |            |
| temp_min            | DECIMAL(5,2)  | 最低温度                         |            |
| temp_max            | DECIMAL(5,2)  | 最高温度                         |            |
| pressure            | INT           | 气压(hPa)                        |            |
| humidity            | INT           | 湿度(%)                          |            |
| wind_speed          | DECIMAL(5,2)  | 风速                             |            |
| wind_deg            | INT           | 风向(度)                         |            |
| wind_gust           | DECIMAL(5,2)  | 阵风                             |            |
| clouds_all          | INT           | 云量(%)                          |            |
| visibility          | INT           | 能见度(米)                       |            |
| pop                 | DECIMAL(3,2)  | 降水概率                         |            |
| rain_3h             | DECIMAL(5,2)  | 3小时降雨量(mm)                  |            |
| snow_3h             | DECIMAL(5,2)  | 3小时降雪量(mm)                  |            |
| weather_id          | INT           | 天气状况ID                       |            |
| weather_main        | VARCHAR(50)   | 天气主要状况                     |            |
| weather_description | VARCHAR(100)  | 天气描述                         |            |
| weather_icon        | VARCHAR(20)   | 天气图标                         |            |
| created_at          | DATETIME      | 记录创建时间                     | 非空       |

### weather_historical 历史天气表

| 字段名              | 数据类型      | 描述            | 约束       |
| ------------------- | ------------- | --------------- | ---------- |
| id                  | BIGINT        | 记录ID          | 主键，自增 |
| latitude            | DECIMAL(10,6) | 纬度            | 非空       |
| longitude           | DECIMAL(10,6) | 经度            | 非空       |
| dt                  | BIGINT        | 历史时间戳      | 非空       |
| temp                | DECIMAL(5,2)  | 温度            | 非空       |
| feels_like          | DECIMAL(5,2)  | 体感温度        |            |
| pressure            | INT           | 气压(hPa)       |            |
| humidity            | INT           | 湿度(%)         |            |
| temp_min            | DECIMAL(5,2)  | 最低温度        |            |
| temp_max            | DECIMAL(5,2)  | 最高温度        |            |
| wind_speed          | DECIMAL(5,2)  | 风速            |            |
| wind_deg            | INT           | 风向(度)        |            |
| clouds_all          | INT           | 云量(%)         |            |
| rain_1h             | DECIMAL(5,2)  | 1小时降雨量(mm) |            |
| rain_3h             | DECIMAL(5,2)  | 3小时降雨量(mm) |            |
| snow_1h             | DECIMAL(5,2)  | 1小时降雪量(mm) |            |
| snow_3h             | DECIMAL(5,2)  | 3小时降雪量(mm) |            |
| weather_id          | INT           | 天气状况ID      |            |
| weather_main        | VARCHAR(50)   | 天气主要状况    |            |
| weather_description | VARCHAR(100)  | 天气描述        |            |
| weather_icon        | VARCHAR(20)   | 天气图标        |            |
| created_at          | DATETIME      | 记录创建时间    | 非空       |

### weather_statistic 天气统计表

| 字段名               | 数据类型      | 描述         | 约束       |
| -------------------- | ------------- | ------------ | ---------- |
| id                   | BIGINT        | 记录ID       | 主键，自增 |
| latitude             | DECIMAL(10,6) | 纬度         | 非空       |
| longitude            | DECIMAL(10,6) | 经度         | 非空       |
| month                | TINYINT       | 月份(1-12)   | 非空       |
| day                  | TINYINT       | 日期(1-31)   |            |
| temp_record_min      | DECIMAL(5,2)  | 历史最低温度 |            |
| temp_record_max      | DECIMAL(5,2)  | 历史最高温度 |            |
| temp_avg_min         | DECIMAL(5,2)  | 平均最低温度 |            |
| temp_avg_max         | DECIMAL(5,2)  | 平均最高温度 |            |
| temp_median          | DECIMAL(5,2)  | 温度中位数   |            |
| temp_mean            | DECIMAL(5,2)  | 温度平均值   |            |
| pressure_min         | INT           | 最低气压     |            |
| pressure_max         | INT           | 最高气压     |            |
| pressure_median      | INT           | 气压中位数   |            |
| pressure_mean        | DECIMAL(6,2)  | 气压平均值   |            |
| humidity_min         | INT           | 最低湿度     |            |
| humidity_max         | INT           | 最高湿度     |            |
| humidity_median      | INT           | 湿度中位数   |            |
| humidity_mean        | DECIMAL(5,2)  | 湿度平均值   |            |
| precipitation_min    | DECIMAL(5,2)  | 最低降水量   |            |
| precipitation_max    | DECIMAL(5,2)  | 最高降水量   |            |
| precipitation_median | DECIMAL(5,2)  | 降水量中位数 |            |
| precipitation_mean   | DECIMAL(5,2)  | 降水量平均值 |            |
| created_at           | DATETIME      | 创建时间     | 非空       |
| updated_at           | DATETIME      | 更新时间     | 非空       |

## 预警相关表

### alert_rule 预警规则表

| 字段名          | 数据类型     | 描述                                    | 约束           |
| --------------- | ------------ | --------------------------------------- | -------------- |
| id              | BIGINT       | 规则ID                                  | 主键，自增     |
| user_id         | BIGINT       | 用户ID                                  | 外键，非空     |
| field_id        | BIGINT       | 地块ID(为空表示所有地块)                | 外键           |
| rule_name       | VARCHAR(50)  | 规则名称                                | 非空           |
| rule_type       | TINYINT      | 规则类型(1:高温,2:低温,3:强降水,4:强风) | 非空           |
| threshold_value | DECIMAL(5,2) | 阈值                                    | 非空           |
| is_active       | BOOLEAN      | 是否启用                                | 非空，默认true |
| created_at      | DATETIME     | 创建时间                                | 非空           |
| updated_at      | DATETIME     | 更新时间                                | 非空           |

### alert_event 预警事件表

| 字段名          | 数据类型     | 描述                             | 约束        |
| --------------- | ------------ | -------------------------------- | ----------- |
| id              | BIGINT       | 事件ID                           | 主键，自增  |
| user_id         | BIGINT       | 用户ID                           | 外键，非空  |
| field_id        | BIGINT       | 地块ID                           | 外键，非空  |
| rule_id         | BIGINT       | 触发规则ID                       | 外键，非空  |
| alert_type      | TINYINT      | 预警类型                         | 非空        |
| alert_value     | DECIMAL(5,2) | 触发值                           | 非空        |
| threshold_value | DECIMAL(5,2) | 阈值                             | 非空        |
| forecast_time   | DATETIME     | 预报时间(为空表示实时)           |             |
| status          | TINYINT      | 状态(0:未处理,1:已处理,2:已忽略) | 非空，默认0 |
| created_at      | DATETIME     | 创建时间                         | 非空        |
| updated_at      | DATETIME     | 更新时间                         | 非空        |

## 系统管理表

### system_config 系统配置表

| 字段名       | 数据类型     | 描述     | 约束       |
| ------------ | ------------ | -------- | ---------- |
| id           | BIGINT       | 配置ID   | 主键，自增 |
| config_key   | VARCHAR(50)  | 配置键名 | 非空，唯一 |
| config_value | TEXT         | 配置值   | 非空       |
| description  | VARCHAR(255) | 配置描述 |            |
| updated_at   | DATETIME     | 更新时间 | 非空       |

### announcement 系统公告表

| 字段名       | 数据类型     | 描述                           | 约束       |
| ------------ | ------------ | ------------------------------ | ---------- |
| id           | BIGINT       | 公告ID                         | 主键，自增 |
| title        | VARCHAR(100) | 公告标题                       | 非空       |
| content      | TEXT         | 公告内容                       | 非空       |
| type         | TINYINT      | 公告类型(1:系统,2:维护,3:功能) | 非空       |
| status       | TINYINT      | 状态(0:草稿,1:发布)            | 非空       |
| publish_time | DATETIME     | 发布时间                       |            |
| expire_time  | DATETIME     | 过期时间                       |            |
| created_at   | DATETIME     | 创建时间                       | 非空       |
| updated_at   | DATETIME     | 更新时间                       | 非空       |
