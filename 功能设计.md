# 农业气象数据在线监测系统设计与实现

**技术栈**  
- **后端**：Spring Boot + Spring Data JPA + RESTful API  
- **前端**：Vue 3 + Vuex + Vue Router  
- **数据库**：MySQL  
- **定时调度**：Spring Task  
- **第三方**：OpenWeatherMap API  

---

## 一、用户角色功能

### 1. 账户与个人设置

1. **注册／登录**  
   - 账号 + 密码注册／登录  
2. **身份验证**  
   - 找回密码（通过邮箱验证码）  
   - 修改密码  
3. **个人信息管理**  
   - 昵称、头像、联系方式维护  
4. **消息与通知设置**  
   - 站内消息、邮件通知  
   - 通知历史查看  

### 2. 地块管理

1. **地块维护**  
   - 添加／编辑／删除地块  
   - 按“地块组”分类管理  
   - 地块属性：名称、面积、土壤类型（砂质/粘土/壤土等）、作物类型、种植季节、生长阶段  
2. **定位方式**  
   - 经纬度录入  
   - 地图选点（Leaflet 地图组件）  

### 3. 实时气象监测

1. **数据源**  
   - OpenWeatherMap 当前天气 API  
2. **核心参数**  
   - 温度（temp、temp_min、temp_max）、体感温度（feels_like）  
   - 气压（pressure）、湿度（humidity）  
   - 风速（speed）、风向（deg）  
   - 云量（clouds.all）、能见度（visibility）  
   - 降雨量（rain）、降雪量（snow）  
3. **处理流程**  
   1. 调用 API 获取实时天气  
   2. 校验并写入数据库（以 经度+纬度+时间戳 唯一索引，避免重复）  
   3. 返回前端  

### 4. 天气预报模块

1. **调用策略**  
   - **0–4 天**：小时级天气预报 API（96 小时，逐小时数据）  
   - **4–16 天**：16 天天气预报 API（按 3 小时间隔）  
   - **16–30 天**：30 天气候预报 API（每日 12:00 数据）  
2. **处理流程**  
   1. 前端请求时，后端检查数据库中对应 地块 + 时间段 数据完整性  
   2. 如有缺失，调用相应 API 拉取缺失数据  
   3. 按 （经度+纬度+预报时间+类型） 建立唯一索引，写库去重  
   4. 聚合后返回前端  

### 5. 历史天气

1. **历史天气**  
   - 数据源：OpenWeatherMap 历史天气 API（小时级，一次最多允许获取一个月内的）  
2. **处理流程**  
   1. 前端请求时，后端检查数据库中对应 地块 + 时间段 数据完整性  
   2. 如有缺失，调用相应 API 拉取缺失数据  
   3. 按 （经度+纬度+预报时间+类型） 建立唯一索引，写库去重  
   4. 聚合后返回前端  

### 6. 统计分析

1. **功能概述**  
   - 对指定“分析日”（可为历史、当前或预报日期）进行统计分析，将这一天的实际/预报/历史天气，与**过去多年同月同日**的气候统计值进行对比；  
   - 识别温度、降水、湿度等是否处于“偏高”“偏低”或“正常”区间。  

### 7. 阈值预警与通知

1. **预警规则管理**  
   - 高温 / 低温 / 强降水 / 高风速 等阈值设置  
2. **触发机制**  
   - 定时任务（如每 10 分钟）拉取实时 & 预报数据  
   - 判断阈值并生成预警事件  
3. **通知方式**  
   - 站内消息、邮件  
4. **预警历史**  
   - 列表展示已生成的预警记录  

---

## 二、管理员角色功能

### 1. 用户与权限管理

- **用户列表**：全量用户、活跃度筛选  
- **账号操作**：冻结 / 解冻、删除  

### 2. 系统配置管理

1. **API 配置**  
   - OpenWeatherMap API Key 管理  
   - 数据拉取频率设置  
2. **邮件服务配置**  
   - SMTP 参数  
   - 邮件模板管理  

### 3. 系统公告发布

- 发布 / 编辑 / 删除公告  
- 公告分类与前端展示  